# Web3層構造Todoアプリケーション 要件定義書

## 概要

AWS上でDynamoDBを使用したシンプルなWeb3層構造のTodoアプリケーション。Terraformを使用したIaCによるインフラ構築を前提とする。

## システム構成

- **プレゼンテーション層**: React/Vue.js等のSPA
- **アプリケーション層**: API Gateway + AWS Lambda
- **データ層**: Amazon DynamoDB
- **インフラ**: Terraform（IaC）

## ユーザストーリー

### ストーリー1: Todoアイテムの作成

- **である** 一般ユーザー **として**
- **私は** 新しいTodoアイテムを作成 **したい**
- **そうすることで** 実行すべきタスクを記録・管理できる

### ストーリー2: Todoリストの閲覧

- **である** 一般ユーザー **として**
- **私は** 登録済みのTodoリストを閲覧 **したい**
- **そうすることで** 現在のタスク状況を把握できる

### ストーリー3: Todoアイテムの更新

- **である** 一般ユーザー **として**
- **私は** 既存のTodoアイテムの内容や状態を更新 **したい**
- **そうすることで** タスクの進捗を正確に反映できる

### ストーリー4: Todoアイテムの削除

- **である** 一般ユーザー **として**
- **私は** 不要になったTodoアイテムを削除 **したい**
- **そうすることで** リストを整理できる

### ストーリー5: インフラの自動構築

- **である** 開発者・運用者 **として**
- **私は** Terraformを使用してAWSインフラを自動構築 **したい**
- **そうすることで** 環境の一貫性と再現性を確保できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムはTodoアイテムの作成機能を提供しなければならない
- REQ-002: システムはTodoアイテムのリスト表示機能を提供しなければならない
- REQ-003: システムはTodoアイテムの更新機能を提供しなければならない
- REQ-004: システムはTodoアイテムの削除機能を提供しなければならない
- REQ-005: システムはDynamoDBにデータを永続化しなければならない
- REQ-006: システムはREST API形式でデータのやり取りを行わなければならない

### 条件付き要件

- REQ-101: ユーザーがTodoアイテムを作成する場合、システムはタイトルの入力を必須としなければならない
- REQ-102: ユーザーがTodoアイテムを更新する場合、システムは既存データの存在確認を行わなければならない
- REQ-103: ユーザーがTodoアイテムを削除する場合、システムは確認メッセージを表示しなければならない
- REQ-104: API呼び出しが失敗した場合、システムは適切なエラーメッセージを返却しなければならない

### 状態要件

- REQ-201: Todoアイテムが完了状態にある場合、システムは視覚的に区別して表示しなければならない
- REQ-202: データベース接続が利用不可な状態にある場合、システムはエラー画面を表示しなければならない

### オプション要件

- REQ-301: システムはTodoアイテムの期限設定機能を提供してもよい
- REQ-302: システムはTodoアイテムの優先度設定機能を提供してもよい
- REQ-303: システムはTodoアイテムのカテゴリ分類機能を提供してもよい

### 制約要件

- REQ-401: システムはAWS上で動作しなければならない
- REQ-402: システムはTerraformによるインフラ構築に対応しなければならない
- REQ-403: システムはサーバーレス構成を採用しなければならない
- REQ-404: システムはWeb3層構造に準拠しなければならない

## データモデル

### TodoItem

```
{
  "id": "string (UUID)",
  "title": "string",
  "description": "string (optional)",
  "completed": "boolean",
  "createdAt": "string (ISO 8601)",
  "updatedAt": "string (ISO 8601)"
}
```

## API仕様

### エンドポイント

- `GET /todos` - Todoリストの取得
- `POST /todos` - 新規Todoアイテムの作成
- `PUT /todos/{id}` - Todoアイテムの更新
- `DELETE /todos/{id}` - Todoアイテムの削除

## 非機能要件

### パフォーマンス

- NFR-001: APIレスポンス時間は1秒以内でなければならない
- NFR-002: システムは同時100ユーザーのアクセスに対応しなければならない
- NFR-003: DynamoDBのReadCapacityUnitは5、WriteCapacityUnitは5で設定しなければならない

### セキュリティ

- NFR-101: APIエンドポイントはHTTPS通信でなければならない
- NFR-102: システムはCORS設定を適切に構成しなければならない
- NFR-103: DynamoDBテーブルは最小権限の原則に従ってアクセス制御しなければならない

### ユーザビリティ

- NFR-201: UIはレスポンシブデザインでなければならない
- NFR-202: APIエラーは分かりやすいメッセージで表示しなければならない
- NFR-203: データの読み込み中はローディング表示をしなければならない

### 運用性

- NFR-301: システムはTerraformによる完全な再構築が可能でなければならない
- NFR-302: CloudWatchによる基本的な監視機能を提供しなければならない
- NFR-303: Lambda関数のログ出力機能を提供しなければならない

## Edgeケース

### エラー処理

- EDGE-001: 存在しないTodoアイテムにアクセスした場合は404エラーを返却する
- EDGE-002: 不正なJSONフォーマットのリクエストの場合は400エラーを返却する
- EDGE-003: DynamoDB接続エラーの場合は500エラーを返却する
- EDGE-004: Lambda関数のタイムアウトの場合は504エラーを返却する

### 境界値

- EDGE-101: Todoタイトルの最大文字数は100文字とする
- EDGE-102: 説明文の最大文字数は1000文字とする
- EDGE-103: 一度に取得できるTodoアイテムの最大数は100件とする

### データ整合性

- EDGE-201: 同一IDのTodoアイテムが重複して作成されることを防ぐ
- EDGE-202: 削除されたTodoアイテムへの更新操作を適切に処理する

## インフラ要件

### Terraformリソース

- VPC（オプション：シンプル構成の場合はデフォルトVPC使用）
- API Gateway
- Lambda Functions
- DynamoDB Table
- IAM Roles and Policies
- CloudWatch Log Groups

## 受け入れ基準

### 機能テスト

- [ ] 新規Todoアイテムの作成が正常に動作する
- [ ] Todoリストの表示が正常に動作する
- [ ] 既存Todoアイテムの更新が正常に動作する
- [ ] Todoアイテムの削除が正常に動作する
- [ ] 完了状態の切り替えが正常に動作する

### API テスト

- [ ] GET /todos が200レスポンスを返す
- [ ] POST /todos が201レスポンスを返す
- [ ] PUT /todos/{id} が200レスポンスを返す
- [ ] DELETE /todos/{id} が204レスポンスを返す
- [ ] 存在しないリソースへのアクセスが404エラーを返す

### インフラテスト

- [ ] Terraformによるインフラ構築が成功する
- [ ] API Gatewayが正常にデプロイされる
- [ ] Lambda関数が正常に実行される
- [ ] DynamoDBテーブルが作成される
- [ ] IAMポリシーが適切に設定される

### 非機能テスト

- [ ] APIレスポンスが1秒以内に返却される
- [ ] HTTPS通信が正常に動作する
- [ ] CORS設定が適切に機能する
- [ ] エラーハンドリングが適切に動作する
- [ ] CloudWatchにログが出力される

### エッジケーステスト

- [ ] 不正なJSONデータでの400エラー処理
- [ ] 存在しないIDでの404エラー処理
- [ ] 文字数上限を超えた場合の400エラー処理
- [ ] DynamoDB接続エラー時の500エラー処理